<div class="chon-ve-body">
  <!-- Header nh·ªè -->
  <div class="chon-ve-header mt-3">
    <a href="javascript:history.back()"><i class="fas fa-arrow-left me-2"></i> Tr·ªü v·ªÅ</a>
    <h5>Ch·ªçn v√©</h5>
  </div>

  <!-- N·ªôi dung 2 c·ªôt -->
  <div class="chon-ve-content">
    <!-- C·ªôt tr√°i: Danh s√°ch v√© -->
    <div class="danh-sach-ve">
      <table>
        <thead>
          <tr>
            <th>Lo·∫°i v√©</th>
            <th style="text-align:right;">S·ªë l∆∞·ª£ng</th>
          </tr>
        </thead>
        <tbody>
          {{#each event.prices}}
          <tr>
            <td>
              <strong>{{this.type}}</strong><br>
              <span>{{this.price}} ƒë</span>
            </td>
            <td>
              <div class="quantity-control">
                <button onclick="capNhatSoLuong(this, -1)">-</button>
                <input type="text" class="o-luong-ve" value="0" readonly>
                <button onclick="capNhatSoLuong(this, 1)">+</button>
              </div>
            </td>
          </tr>
          {{/each}}
        </tbody>
      </table>
    </div>

    <!-- C·ªôt ph·∫£i: Th√¥ng tin v√© -->
    <div class="thong-tin-ve">
      <div class="thong-tin-top">
        <h5>{{event.name}}</h5>
        <p><i class="far fa-clock"></i> {{event.time}}</p>
        <p><i class="fas fa-map-marker-alt"></i> {{event.location}}</p>
        <hr>
        <div>
          <h6>Gi√° v√©</h6>
          <ul>
            {{#each event.prices}}
            <li>
              <span>{{this.type}}</span>
              <span class="text-success">{{this.price}} ƒë</span>
            </li>
            {{/each}}
          </ul>
        </div>
      </div>

      <div class="thong-tin-bottom">
        <div class="total-tickets">
          <i class="fas fa-ticket-alt"></i>
          <span>T·ªïng: <strong id="tongSoLuong">0</strong> v√©</span>
        </div>
        <button id="nutTiepTuc">
          Vui l√≤ng ch·ªçn v√© <i class="fas fa-angle-double-right ms-2"></i>
        </button>
      </div>
    </div>
  </div>
</div>


<!-- JS -->
<script>
  const danhSachGiaVe = {{{json event.prices}}};

  function capNhatSoLuong(nut, thayDoi) {
    const oNhap = nut.parentElement.querySelector('.o-luong-ve');
    let soLuong = parseInt(oNhap.value);
    soLuong = Math.max(0, soLuong + thayDoi);
    oNhap.value = soLuong;
    tinhTongTien();
  }

  function tinhTongTien() {
    let tongSoLuong = 0;
    let tongTien = 0;
    const cacONhap = document.querySelectorAll('.o-luong-ve');
    const danhSachDaChon = [];

    cacONhap.forEach((oNhap, i) => {
      const soLuong = parseInt(oNhap.value);
      const giaVeStr = danhSachGiaVe[i].price;
      const giaVe = parseInt(giaVeStr.replace(/\./g, ''));

      if (soLuong > 0) {
        danhSachDaChon.push({
          type: danhSachGiaVe[i].type,
          price: giaVeStr,
          quantity: soLuong
        });
      }

      tongSoLuong += soLuong;
      tongTien += soLuong * giaVe;
    });

    document.getElementById('tongSoLuong').innerText = tongSoLuong;
    const nutTiepTuc = document.getElementById('nutTiepTuc');

    if (tongSoLuong > 0) {
      nutTiepTuc.classList.add('active');
      nutTiepTuc.innerHTML = `Ti·∫øp t·ª•c - <span>${tongTien.toLocaleString()}</span> ƒë <i class="fas fa-angle-double-right ms-2"></i>`;

      nutTiepTuc.onclick = () => {
        // üîÅ L∆∞u v√†o localStorage
        localStorage.setItem('selectedTickets', JSON.stringify(danhSachDaChon));
        // üîÅ Chuy·ªÉn trang
        window.location.href = window.location.pathname + '/confirm_booking';
      };
    } else {
      nutTiepTuc.classList.remove('active');
      nutTiepTuc.innerHTML = `Vui l√≤ng ch·ªçn v√© <i class="fas fa-angle-double-right ms-2"></i>`;
      nutTiepTuc.onclick = null;
    }
  }
</script>

