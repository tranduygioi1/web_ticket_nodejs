{{!-- Hiển thị thông báo flash --}}
{{#if messages}}
  {{#each messages}}
    <div class="alert alert-{{this.type}} alert-dismissible fade show mt-2" role="alert">
      {{this.message}}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {{/each}}
{{/if}}


<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
  <h1>List Event</h1>

<form class="d-flex align-items-center gap-2" method="GET" action="/admin/list_event">
  <select class="form-select" name="category" style="max-width: 200px;">
    <option value="">Tất cả danh mục</option>
    <option value="special"> Special</option>
    <option value="trending"> Trending</option>
    <option value="foryou"> For You</option>
    <option value="livemusic"> Live Music</option>
    <option value="stageart"> Stage Art</option>
  </select>

  <button class="btn text-white btn-light" style="background-color: #28a745;" type="submit">
    Tìm kiếm
  </button>

  <input class="form-control" type="search" name="q" value="{{keyword}}" placeholder="Nhập tên sự kiện..." aria-label="Search" style="max-width: 300px;">
</form>

</div>

<table class="table table-striped mt-3">
  <thead class="table-dark">
    <tr>
      <th scope="col">#</th>
      <th scope="col">Danh Mục</th>
      <th scope="col" style="width: 350px;">Tên Sự Kiện</th>
      <th scope="col" style="width: 300px">Địa Điểm</th>
      <th scope="col">Thời Gian</th>
      <th scope="col">Hành động</th>
    </tr>
  </thead>

  <tbody>
    {{#each allEvent}}
    <tr>
      <th scope="row">{{sum @index 1}}</th>
      <td style="width: 110px;">{{this.category}}</td>
      <td>{{this.name}}</td>
      <td>{{this.location}}</td>
      <td>{{this.time}}</td>
      <td class="text-center">
        <a href="/admin/{{this._id}}/update_event" class="btn btn-sm btn-primary mt-2">Update</a>
        <a href="#" 
          class="btn btn-sm btn-danger mt-2" 
          data-id="{{this._id}}"
          data-bs-toggle="modal" 
          data-bs-target="#delete-event-modal"
          data-name="{{this.name}}">
          Xóa bỏ
        </a>
      </td>
    </tr>
    {{/each}}
  </tbody>
</table>

{{!--Confirm DELETE--}}
<div id="delete-event-modal" class="modal fade" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Xóa sự kiện</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
      </div>
      <div class="modal-body">
        <p id="modal-message">Bạn có chắc chắn muốn xóa sự kiện này không?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" id="btn-delete">DELETE</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
{{!-- DELETE form ẩn --}}
<form name="delete-event-form" method="POST"></form>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const deleteModal = document.getElementById('delete-event-modal');
    const modalMessage = document.getElementById('modal-message');
    const btnDelete = document.getElementById('btn-delete');
    const deleteForm = document.forms['delete-event-form'];

    let currentId = null;

    // Khi mở modal
    if (deleteModal) {
      deleteModal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;
        currentId = button.getAttribute('data-id');
        const eventName = button.getAttribute('data-name');

        modalMessage.textContent = `Bạn có chắc chắn muốn xóa sự kiện "${eventName}" này không?`;
      });
    }

    // Khi bấm nút DELETE
    if (btnDelete) {
      btnDelete.addEventListener('click', function () {
        if (currentId) {
          // Gửi form với method override
          deleteForm.action = `/admin/${currentId}?_method=DELETE`;
          deleteForm.submit();
        }
      });
    }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
