<h1 class="mt-3">Quản lý Quyền</h1>

<form id="formQuyen" action="/admin/add_role" method="POST" class="mt-3">
  <input type="hidden" id="quyenId" name="id" value="">
  
  <table class="table table-bordered table-hover">
    <thead class="table-dark">
      <tr>
        <th style="width: 50px;">#</th>
        <th style="width: 250px;">Tên quyền</th>
        <th>Mô tả</th>
        <th style="width: 200px;">Hành động</th>
        <th style="width: 200px;">Thời gian tạo</th>
      </tr>
    </thead>
    <tbody>
      <!-- Hàng nhập thêm hoặc cập nhật -->
      <tr>
        <td>+</td>
        <td>
          <select id="tenQuyen" name="role_name" class="form-control" required>
            <option value="">-- Chọn quyền --</option>
            <option value="Create event">Create event</option>
            <option value="Manage list event">Manage list event</option>
            <option value="Manage ticket">Manage ticket</option>
            <option value="Manage admin">Manage admin</option>
            <option value="Manage roles">Manage Roles</option>
            <option value="Manage assign">Manage assign</option>

          </select>
        </td>
        <td>
          <input type="text" id="moTa" name="description" class="form-control" placeholder="Mô tả" required>
        </td>
        <td class="text-center">
          <button type="submit" id="nutGui" class="btn btn-success btn-sm w-50">Thêm</button>
        </td>
      </tr>
    </form>

      <!-- Danh sách quyền -->
      {{#each roles}}
      <tr>
        <th scope="row">{{sum @index 1}}</th>
        <td>{{this.role_name}}</td>
        <td>{{this.description}}</td>
        <td class="text-center">
          <div class="d-flex justify-content-center gap-2">
            <!-- Nút sửa -->
            <button type="button" class="btn btn-warning btn-sm w-100" 
              onclick="suaQuyen('{{this._id}}', '{{this.role_name}}', '{{this.description}}')">
              Sửa
            </button>
            <!-- Nút xóa -->
            <form action="/admin/delete_role/{{this._id}}" method="POST" 
                  onsubmit="return confirm('Bạn có chắc chắn muốn xóa quyền này không?')">
              <button type="submit" class="btn btn-danger btn-sm w-100">Xóa</button>
            </form>
          </div>
        </td>
        <td>{{ formatDate this.createdAt}}</td>
      </tr>
      {{/each}}
    </tbody>
  </table>

<script>
  function suaQuyen(id, ten, moTa) {
    // Gán dữ liệu vào các ô nhập
    document.getElementById('quyenId').value = id;
    document.getElementById('tenQuyen').value = ten;
    document.getElementById('moTa').value = moTa;

    // Đổi nút từ "Thêm" sang "Cập nhật"
    const nutGui = document.getElementById('nutGui');
    nutGui.textContent = "Cập nhật";
    nutGui.classList.remove("btn-success");
    nutGui.classList.add("btn-primary");

    // Đổi action của form sang cập nhật
    const formQuyen = document.getElementById('formQuyen');
    formQuyen.action = "/admin/edit_role/" + id;
    formQuyen.method = "POST";
  }
</script>
